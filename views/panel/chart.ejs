<!doctype html>
<html lang="fa-IR" dir="rtl">

<%- include("layout/head",{title:'پنل سامانه سلامت'}) %>

<link rel="stylesheet" href="/assets/plugins/persian_dpicker/css/persianDatepicker-default.css">

<link rel="stylesheet" href="/css/tagify.css">
<link rel="stylesheet" href="/css/toastify.min.css">


<body class="app sidebar-mini rtl light-mode">
    <%- include('layout/switcher') %>
    <!-- GLOBAL-LOADER -->
    <div id="global-loader">
        <img src="/assets/images/loader.svg" class="loader-img" alt="Loader">
    </div>
    <!-- /GLOBAL-LOADER -->

    <!-- PAGE -->
    <div class="page">
        <div class="page-main">

            <!-- app-Header -->
            <% 
            if(login.accessibility.userLevel == 'Administrator'){
            %>
            <%-include('layout/header',{login})%>
            <%-include('layout/sidebar')%>
            <%    
            }else{
                %>

            <%-include('employer/layout/header',{login})%>
            <%-include('employer/layout/sidebar')%>
            <%}%>

            <!----=====================================APP-CONTENT OPEN =========================================-->
            <div class="main-content app-content mt-0">
                <div class="side-app">

                    <!-- CONTAINER -->
                    <div class="main-container container-fluid">
                        <br />
                        <!-- ROW-1 OPEN -->
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">تعداد افراد به تفکیک جنسیت</h3>
                                    </div>
                                    <div class="card-body">
                                        <div id="chart-donut" class="chartsh"></div>
                                    </div>
                                </div>
                            </div>
                             <div class="col-lg-6 col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">تعداد افراد به تفکیک تحصیلات</h3>
                                    </div>
                                    <div class="card-body">
                                        <div id="chart-donut2" class="chartsh"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">تعداد افراد به تفکیک وضعیت مالی</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="chartPolar" class="h-275"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                            <!--<div class="col-lg-6 col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">نمودار دونات</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="chartPie" class="h-275"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">نمودار پای</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="chartDonut" class="h-275"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">نمودار رادار</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="chartRadar" class="h-275"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                         -->
                        </div>
                        <!-- ROW-1 CLOSE -->
                    </div>
                    <!-- CONTAINER CLOSED -->
                </div>
            </div>
            <!--=============================================== APP-CONTENT CLOSE ==================================-->
        </div>

        <!-- FOOTER -->
        <footer class="footer">
            <div class="loader" id="loader" style="display: none;">
                <div class="text">
                    <p>در حال تهیه گزارش </p>
                </div>
                <span><i></i></span>
            </div>
        </footer>
        <!-- FOOTER END -->

    </div>

    <!-- BACK-TO-TOP -->
    <a href="#top" id="back-to-top"><i class="fa fa-angle-up"></i></a>

    <%- include('layout/script.ejs') %>
    <!-- CHART-CIRCLE JS-->
    <script src="/assets/js/circle-progress.min.js"></script>
    <!-- CHARTJS JS -->
    <script src="/assets/plugins/chart/Chart.bundle.js"></script>
    <script src="/assets/js/chart.js"></script>
    <!-- SWEET-ALERT JS -->
    <script src="/assets/plugins/persian_dpicker/js/persianDatepicker.min.js"></script>
    <!-- C3 CHART JS -->
    <script src="../assets/plugins/charts-c3/d3.v5.min.js"></script>
    <script src="../assets/plugins/charts-c3/c3-chart.js"></script>

    <script src="/assets/plugins/sweet-alert/sweetalert.min.js"></script>
    <script src="/js/tagify.min.js"></script>
    <script src="/js/toastify-js.js"></script>
    <script src="/js/chart.js"></script>
    <script src="/js/jalali-moment.browser.js"></script>
<script src="/js/validate.js"></script>    <script>
        $(document).ready(() => {
            $("#reportFrom").persianDatepicker({
                formatDate: "YYYY/0M/0D"
            });
            $("#reportTo").persianDatepicker({
                formatDate: "YYYY/0M/0D",
            });

            $(document).on('click', '.deleteModal', (e) => {
                $('.deleteReport').attr('data-id', $(e.target).closest('a').attr('data-id'));
            })
            $('.deleteReport').on('click', (e) => {
                let _id = $(e.target).attr('data-id');
                window.location.href = `<%=process.env.SITEURL%>/panel/report/delete/${_id}`;
            })
            $('#userSearch').on('click', () => {
                let searchInput = $('#searchInput').val().trim();
                window.location.href = `<%=process.env.SITEURL%>/panel/em/patient/search/${searchInput}`;
            })
            let inputElm = document.querySelector('input[name="tags"]');
            let tagify = new Tagify(inputElm);
            let editElm = null;
            $('._pHistory').on('click', (e) => {
                editElm = e;
                tagify.removeAllTags();
                $('#regHInfo').attr('data-id', $(e.target).closest('a').attr('data-id'));
                let _historyData = $(e.target).closest('a').attr('data-value');
                _historyData = JSON.parse(_historyData);
                $('input[name="allergy"][value="yes"]').prop('checked', _historyData.allergy);
                $('input[name="allergy"][value="no"]').prop('checked', !_historyData.allergy);
                $('input[name="testResult"][value="yes"]').prop('checked', _historyData.testResult);;
                $('input[name="testResult"][value="no"]').prop('checked', !_historyData.testResult);;
                tagify.addTags(_historyData.chronicDiseases)
            });


            $('#getReport').on('click', (e) => {
                let reportFrom = $('#reportFrom').val();
                let reportTo = $('#reportTo').val();
                let data = JSON.stringify({
                    reportFrom, reportTo
                });
                $.ajax({
                    url: `<%=process.env.SITEURL%>/panel/getReport`,
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: data,
                    beforeSend: () => {
                        $('#loader').fadeIn(500);
                    },
                    success: (res) => {
                        $('#loader').fadeOut(500);
                        if (res.statusCode === 200) {
                            $('#reportList').prepend(`
                            <tr>
                                <td class="text-nowrap align-middle">
                                    ${moment(res.report.createdAt).locale('fa').format('HH:mm YYYY/MM/DD')}
                                </td>
                                <td class="text-nowrap align-middle">
                                    <i class="fa fa-file-pdf-o" style="font-size: 18px;"></i>
                                    <a href="<%=process.env.SITEURL%>/${res.report.filePath}%>"
                                        target="_blank">دانلود فایل</a>
                                </td>
                                <td class="text-nowrap align-middle">
                                    <a class="btn btn-sm btn-danger badge modal-effect deleteModal"
                                        data-bs-effect="effect-super-scaled"
                                        data-id="${res.report._id.toString()}"
                                        data-bs-toggle="modal" href="#modaldemo8"
                                        type="button"><i class="fa fa-trash"></i></a>
                                </td>
                            </tr>
                            `);
                            Toastify({
                                text: "گزارش با موفقیت تهیه شد.",
                                duration: 3000,
                                newWindow: true,
                                close: true,
                                gravity: "bottom", // `top` or `bottom`
                                position: "left", // `left`, `center` or `right`
                                stopOnFocus: true, // Prevents dismissing of toast on hover
                                style: {
                                    background: "linear-gradient(to right, rgb(4 126 36), rgb(0 223 110))",
                                },
                            }).showToast();
                        }
                    },
                    error: function (err) {
                        $('#loader').fadeOut(500);
                        console.log(err)
                    }
                });
            });


        });
    </script>
</body>


</html>